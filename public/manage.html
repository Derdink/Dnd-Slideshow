<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Manage Pictures</title>
    <link rel="icon" href="/icons/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/icons/favicon.ico" type="image/x-icon">
    <!-- NEW: Include IBM Carbon Components CSS -->
    <link rel="stylesheet" href="https://unpkg.com/carbon-components@10.48.0/css/carbon-components.min.css" />
    <link rel="stylesheet" href="styles.css" />
    <link rel="manifest" href="manifest.json" />

</head>

<body class="manage">
    <!-- Replace the separate header and details with a single section -->
    <section id="settingsSection">
        <div id="manageHeader">
            <h2 id="manageTitle">Settings</h2>
            <div class="header-controls">
                <!-- Previous button -->
                <button id="headerPrevBtn" class="nav-btn" title="Previous">
                    <svg focusable="false" preserveAspectRatio="xMidYMid meet" fill="currentColor" width="24" height="24" viewBox="0 0 32 32">
                        <path d="M14 26L15.41 24.59 7.83 17 28 17 28 15 7.83 15 15.41 7.41 14 6 4 16 14 26z"></path>
                    </svg>
                </button>
                <!-- Play button - Changed to pause icon initially -->
                <button id="headerPlayBtn" class="nav-btn" title="Pause">
                    <svg focusable="false" preserveAspectRatio="xMidYMid meet" fill="currentColor" width="24" height="24" viewBox="0 0 32 32">
                        <path d="M12 8V24H8V8h4m1-2H7v20h6V6zM24 8V24H20V8h4m1-2H19v20h6V6z"></path>
                    </svg>
                </button>
                <!-- Reset button -->
                <button id="headerResetBtn" class="nav-btn" title="Reset">
                    <svg focusable="false" preserveAspectRatio="xMidYMid meet" fill="currentColor" width="24" height="24" viewBox="0 0 32 32">
                        <path d="M26,18A10,10,0,1,1,16,8h6.18L19.5,10.59,20.91,12l5-5L20.91,2,19.5,3.41,22.18,6H16A12,12,0,1,0,28,18Z"></path>
                    </svg>
                </button>
                <!-- Next button -->
                <button id="headerNextBtn" class="nav-btn" title="Next">
                    <svg focusable="false" preserveAspectRatio="xMidYMid meet" fill="currentColor" width="24" height="24" viewBox="0 0 32 32">
                        <path d="M18 6L16.57 7.393 24.15 15 4 15 4 17 24.15 17 16.57 24.573 18 26 28 16 18 6z"></path>
                    </svg>
                </button>
                <button id="settingsToggle" class="settingsToggle">
                    <svg focusable="false" preserveAspectRatio="xMidYMid meet" fill="currentColor" width="24" height="24" viewBox="0 0 32 32">
                        <path d="M27.5474,12.0005l1.7322-1-2.3354-4.0444c-.3652-.6328-1.0334-1.0005-1.7322-1.0005-.2134,0-.4294.0342-.6406.106l-2.4341.8232c-.418-.2812-.856-.5352-1.312-.7583l-.5037-2.5186c-.187-.9351-1.0078-1.6079-1.9612-1.6079h-4.7207c-.9534,0-1.7742.6729-1.9612,1.6079l-.5037,2.5186c-.459.2246-.9062.4692-1.3267.7534l-2.4194-.8184c-.2112-.0718-.4272-.106-.6406-.106-.6987,0-1.3669.3677-1.7322,1.0005l-2.3606,4.0879c-.4766.8257-.3042,1.873.4119,2.5024l1.9309,1.6968c-.0171.2515-.0381.5015-.0381.7568,0,.2578.0103.5127.0278.7656l-1.9207,1.688c-.7161.6294-.8884,1.6768-.4119,2.5024l2.3606,4.0879c.3652.6328,1.0334,1.0005,1.7322,1.0005.2134,0,.4297-.0342.6406-.106l2.4341-.8232c.418.2817.856.5352,1.312.7583l.5037,2.5186c.187.9351,1.0078,1.6079,1.9612,1.6079h2.3604v-2h-2.3604l-.7102-3.5508c-.9753-.356-1.9026-.9062-2.6948-1.5713l-3.4468,1.166-2.3604-4.0879,2.7253-2.395c-.1838-1.043-.1914-2.083-.0071-3.1279l-2.7183-2.3892,2.3611-4.0879,3.4268,1.1592c.8032-.6763,1.7295-1.2051,2.7141-1.5645l.7102-3.5508h4.7207l.7102,3.5508c.9753.356,1.9023.9062,2.6948,1.5713l3.4468-1.166,2.3352,4.0444Z"></path>
                    </svg>
                </button>
            </div>
        </div>
        <div id="settings-details" style="display: none;">
            <!-- Carbon tabs container -->
            <div class="bx--tabs" role="navigation">
                <!-- Tab list -->
                <div class="bx--tabs-trigger">
                    <a href="javascript:void(0)" class="bx--tabs-trigger-text" tabindex="0">Play Settings</a>
                    <svg focusable="false" preserveAspectRatio="xMidYMid meet" style="will-change: transform;" xmlns="http://www.w3.org/2000/svg" width="10" height="6" viewBox="0 0 10 6" aria-hidden="true"><path d="M5 6L0 1 0.7 0.3 5 4.6 9.3 0.3 10 1z"></path></svg>
                </div>
                <ul class="bx--tabs__nav bx--tabs__nav--hidden" role="tablist">
                    <li class="bx--tabs__nav-item bx--tabs__nav-item--selected" role="tab" aria-selected="true">
                        <a class="bx--tabs__nav-link" href="javascript:void(0)" role="tab">Play Settings</a>
                    </li>
                    <li class="bx--tabs__nav-item" role="tab">
                        <a class="bx--tabs__nav-link" href="javascript:void(0)" role="tab">Tag Select</a>
                    </li>
                    <li class="bx--tabs__nav-item" role="tab">
                        <a class="bx--tabs__nav-link" href="javascript:void(0)" role="tab">Playlist</a>
                    </li>
                    <li class="bx--tabs__nav-item" role="tab">
                        <a class="bx--tabs__nav-link" href="javascript:void(0)" role="tab">Upload</a>
                    </li>
                </ul>
            </div>

            <!-- Tab panels -->
            <div class="bx--tab-content">
                <!-- Play Settings tab panel -->
                <div id="tab-panel-1" class="bx--tab-panel" role="tabpanel" aria-labelledby="tab-link-1" aria-hidden="false">
                    <div class="settings-group">
                        <div class="settings-row">

                            <!-- Time inputs using Carbon Number Input -->
                            <div class="bx--form-item bx--number">
                                <div class="time-inputs">
                                    <div class="bx--form-item">
                                        <label for="minutes" class="bx--label">Minutes</label>
                                        <input type="number" id="minutes" min="0" max="60" value="0" class="bx--text-input bx--number__input" />
                                    </div>
                                    <div class="bx--form-item">
                                        <label for="seconds" class="bx--label">Seconds</label>
                                        <input type="number" id="seconds" min="0" max="59" value="3" class="bx--text-input bx--number__input" />
                                    </div>
                                </div>
                            </div>

                            <!-- Order buttons using Carbon Button Set -->
                            <div class="bx--form-item" id="orderContainer">
                                <label class="bx--label">Order:</label>
                                <div class="bx--btn-set">
                                    <button id="orderRandom" class="bx--btn bx--btn--secondary">Random</button>
                                    <button id="orderAlphabetical" class="bx--btn bx--btn--secondary">Alphabetical</button>
                                    <button id="orderGroups" class="bx--btn bx--btn--secondary">Tags</button>
                                </div>
                            </div>

                            <!-- Save button using Carbon Button with icon -->
                            <button id="saveSettingsBtn" class="bx--btn bx--btn--primary">
                                <svg focusable="false" preserveAspectRatio="xMidYMid meet" fill="currentColor" 
                                    width="16" height="16" viewBox="0 0 16 16" aria-hidden="true">
                                    <path d="M13.9,4.6l-2.5-2.5C11.3,2.1,11.1,2,11,2H3C2.4,2,2,2.4,2,3v10c0,0.6,0.4,1,1,1h10c0.6,0,1-0.4,1-1V5      C14,4.9,13.9,4.7,13.9,4.6z M6,3h4v2H6V3z M10,13H6V9h4V13z M11,13V9c0-0.6-0.4-1-1-1H6C5.4,8,5,8.4,5,9v4H3V3h2v2c0,0.6,0.4,1,1,1     h4c0.6,0,1-0.4,1-1V3.2l2,2V13H11z"/>
                                </svg>
                                <span>Save</span>
                            </button>
                            <div id="saveMessage" class="bx--toast-notification bx--toast-notification--success" role="alert" style="display: none;">
                                <div class="bx--toast-notification__details">
                                    <h3 class="bx--toast-notification__title">Success</h3>
                                    <p class="bx--toast-notification__subtitle">Settings saved successfully.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tag Select tab panel -->
                <div id="tab-panel-2" class="bx--tab-panel" role="tabpanel" aria-labelledby="tab-link-2" aria-hidden="true">
                    <div id="tagSelectionWrapper">

                        <button id="playTagsBtn" class="play-button">Play tags</button>
                        <div id="tagSelectionContainer" style="display:flex; flex-wrap: wrap; gap: 0.3em;"></div>
                    </div>
                </div>

                <!-- Playlist tab panel -->
                <div id="tab-panel-3" class="bx--tab-panel" role="tabpanel" aria-labelledby="tab-link-3" aria-hidden="true">
                    <div id="playlistSection">
                        <!-- Playlist content will go here -->
                        <h3>Playlists</h3>
                        <p>Coming soon...</p>
                    </div>
                </div>

                <!-- Upload tab panel -->
                <div id="tab-panel-4" class="bx--tab-panel" role="tabpanel" aria-labelledby="tab-link-4" aria-hidden="true">
                    <section id="uploadSection">

                        <div id="dropArea">
                            <p>Drag & Drop Files Here</p>
                            <button id="selectFiles">Select Files</button>
                        </div>
                        <input type="file" id="fileInput" multiple style="display:none;" />
                        <div id="uploadStatus"></div>
                    </section>
                </div>
            </div>
        </div>
    </section>

    <!-- Pictures Management Section -->
    <section id="management">
        <div id="topControls">
            <div id="tagManagerContainer">
                <button id="tagManagerToggle">Tags</button>
                <form id="newTagForm" style="display: none;">
                    <input type="text" id="newTagName" placeholder="New tag name" required />
                    <button type="submit">Add</button>
                </form>
                <div id="tagManagerSection" style="display: none;"></div>
            </div>
        </div>
        <!-- Wrap the search bar and new filter button in a container -->
        <div id="filterContainer" style="display:flex; align-items:center; gap:0.5rem;">
            <input type="text" id="search" placeholder="Search pictures..." />
            <!-- New Filter Button with SVG icon -->
            <button id="filterBtn" title="Filter images" style="background:transparent; border:none; cursor:pointer;">
                <svg width="24" height="24" viewBox="0 0 32 32" fill="currentColor" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 6h24v2H4zm4 8h16v2H8zm6 8h4v2h-4z"></path>
                </svg>
            </button>
        </div>
        <!-- NEW: Replace #tagFilterDropdown with the same structure as #tagSelectionContainer -->
        <div id="tagFilterDropdown" style="display:none; flex-wrap: wrap; gap: 0.3em;"></div>
        <div id="slideFunctionsContainer">
            <button id="playSelectBtn">Play selected</button>
            <button id="bulkDelete">Bulk Delete</button>
        </div>
        <table id="imageTable">
            <thead>
                <tr>
                    <th class="col-select" data-key="select">
                        <label class="custom-checkbox">
                            <input type="checkbox" id="headerSelect" />
                            <span class="checkmark"></span>
                        </label>
                    </th>
                    <th class="col-thumb"></th>
                    <th class="sortable col-name" data-key="title" data-label="Name">Name</th>
                    <th class="sortable col-tags" data-key="tags" data-label="Tags">Tags</th>
                    <th class="sortable col-date" data-key="dateAdded" data-label="Date">Date</th>
                    <th class="col-actions">Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <!-- Added pagination container -->
        <div id="pagination"></div>
    </section>

    <!-- Add Socket.IO before other scripts -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="socket-client.js"></script>
    <script src="main.js"></script>
    <script src="sw-register.js"></script>
    <!-- NEW: Fix #settingsToggle panel toggle -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const settingsToggle = document.getElementById('settingsToggle');
            const settingsDetails = document.getElementById('settings-details');

            // Set initial state
            settingsDetails.style.display = 'none';

            // Toggle settings visibility
            settingsToggle.addEventListener('click', () => {
                settingsDetails.style.display =
                    settingsDetails.style.display === 'none' ? 'block' : 'none';

                // Toggle active state for the button
                settingsToggle.classList.toggle('active');
            });

            // Initialize Carbon tabs
            const tabList = document.querySelector('.bx--tabs__nav');
            const tabPanels = document.querySelectorAll('.bx--tab-panel');
            const tabItems = document.querySelectorAll('.bx--tabs__nav-item');

            function switchTab(index) {
                // Update tab selection
                tabItems.forEach((item, i) => {
                    if (i === index) {
                        item.classList.add('bx--tabs__nav-item--selected');
                        item.setAttribute('aria-selected', 'true');
                    } else {
                        item.classList.remove('bx--tabs__nav-item--selected');
                        item.setAttribute('aria-selected', 'false');
                    }
                });

                // Show/hide panels
                tabPanels.forEach((panel, i) => {
                    if (i === index) {
                        panel.setAttribute('aria-hidden', 'false');
                        panel.style.display = 'block';
                    } else {
                        panel.setAttribute('aria-hidden', 'true');
                        panel.style.display = 'none';
                    }
                });
            }

            // Add click handlers to tabs
            tabItems.forEach((item, index) => {
                item.addEventListener('click', () => switchTab(index));
            });

            // Initialize first tab
            switchTab(0);

            // Handle dropdown trigger for mobile
            const trigger = document.querySelector('.bx--tabs-trigger');
            trigger.addEventListener('click', () => {
                const nav = document.querySelector('.bx--tabs__nav');
                nav.classList.toggle('bx--tabs__nav--hidden');
            });
        });
    </script>
    <div id="editModal" class="modal" style="display:none;">
        <div class="modal-content">
            <h3>Edit Image Entry</h3>
            <form id="editForm">
                <label for="editTitle">Title:</label>
                <input type="text" id="editTitle" name="editTitle" required>
                <label for="editDescription">Description:</label>
                <textarea id="editDescription" name="editDescription"></textarea>
                <div class="modal-buttons">
                    <button type="button" id="saveEditBtn">Save</button>
                    <button type="button" id="closeEditBtn"></button>
                </div>
            </form>
        </div>
    </div>
</body>

</html>