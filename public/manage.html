<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Manage Pictures</title>
    <link rel="icon" href="/icons/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/icons/favicon.ico" type="image/x-icon">
    <!-- NEW: Include IBM Carbon Components CSS -->
    <link rel="stylesheet" href="https://unpkg.com/carbon-components@10.48.0/css/carbon-components.min.css" />
    <link rel="stylesheet" href="styles.css" />
    <link rel="manifest" href="manifest.json" />

</head>

<body class="manage">
    <!-- Replace the separate header and details with a single section -->
    <section id="settingsSection">
        <div id="manageHeader">
            <h2 id="manageTitle">Settings</h2>
            <div class="header-controls">
                <!-- Previous button -->
                <button id="headerPrevBtn" class="nav-btn" title="Previous">
                    <svg focusable="false" preserveAspectRatio="xMidYMid meet" fill="currentColor" width="32" height="32" viewBox="0 0 32 32" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="M14 26L15.41 24.59 7.83 17 28 17 28 15 7.83 15 15.41 7.41 14 6 4 16 14 26z"></path><title>Prev image</title></svg>
                </button>
                <!-- Play button - Changed to pause icon initially -->
                <button id="headerPlayBtn" class="nav-btn" title="Pause">
                    <svg focusable="false" preserveAspectRatio="xMidYMid meet" fill="currentColor" width="32" height="32" viewBox="0 0 32 32" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="M12 8V24H8V8h4m0-2H8A2 2 0 006 8V24a2 2 0 002 2h4a2 2 0 002-2V8a2 2 0 00-2-2zM24 8V24H20V8h4m0-2H20a2 2 0 00-2 2V24a2 2 0 002 2h4a2 2 0 002-2V8a2 2 0 00-2-2z"></path><title>Pause</title></svg>
                </button>
                <!-- Reset button -->
                <button id="headerResetBtn" class="nav-btn" title="Reset">
                    <svg focusable="false" preserveAspectRatio="xMidYMid meet" fill="currentColor" width="24" height="24" viewBox="0 0 32 32">
                        <path d="M26,18A10,10,0,1,1,16,8h6.18L19.5,10.59,20.91,12l5-5L20.91,2,19.5,3.41,22.18,6H16A12,12,0,1,0,28,18Z"></path>
                    </svg>
                </button>
                <!-- Next button -->
                <button id="headerNextBtn" class="nav-btn" title="Next">
                    <svg focusable="false" preserveAspectRatio="xMidYMid meet" fill="currentColor" width="32" height="32" viewBox="0 0 32 32" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="M18 6L16.57 7.393 24.15 15 4 15 4 17 24.15 17 16.57 24.573 18 26 28 16 18 6z"></path><title>Next image</title></svg>
                </button>
                <button id="settingsToggle" class="settingsToggle">
                    <svg focusable="false" preserveAspectRatio="xMidYMid meet" fill="currentColor" width="32" height="32" viewBox="0 0 32 32" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="M27,16.76c0-.25,0-.5,0-.76s0-.51,0-.77l1.92-1.68A2,2,0,0,0,29.3,11L26.94,7a2,2,0,0,0-1.73-1,2,2,0,0,0-.64.1l-2.43.82a11.35,11.35,0,0,0-1.31-.75l-.51-2.52a2,2,0,0,0-2-1.61H13.64a2,2,0,0,0-2,1.61l-.51,2.52a11.48,11.48,0,0,0-1.32.75L7.43,6.06A2,2,0,0,0,6.79,6,2,2,0,0,0,5.06,7L2.7,11a2,2,0,0,0,.41,2.51L5,15.24c0,.25,0,.5,0,.76s0,.51,0,.77L3.11,18.45A2,2,0,0,0,2.7,21L5.06,25a2,2,0,0,0,1.73,1,2,2,0,0,0,.64-.1l2.43-.82a11.35,11.35,0,0,0,1.31.75l.51,2.52a2,2,0,0,0,2,1.61h4.72a2,2,0,0,0,2-1.61l.51-2.52a11.48,11.48,0,0,0,1.32-.75l2.42.82a2,2,0,0,0,.64.1,2,2,0,0,0,1.73-1L29.3,21a2,2,0,0,0-.41-2.51ZM25.21,24l-3.43-1.16a8.86,8.86,0,0,1-2.71,1.57L18.36,28H13.64l-.71-3.55a9.36,9.36,0,0,1-2.7-1.57L6.79,24,4.43,20l2.72-2.4a8.9,8.9,0,0,1,0-3.13L4.43,12,6.79,8l3.43,1.16a8.86,8.86,0,0,1,2.71-1.57L13.64,4h4.72l.71,3.55a9.36,9.36,0,0,1,2.7,1.57L25.21,8,27.57,12l-2.72,2.4a8.9,8.9,0,0,1,0,3.13L27.57,20Z"></path><path d="M16,22a6,6,0,1,1,6-6A5.94,5.94,0,0,1,16,22Zm0-10a3.91,3.91,0,0,0-4,4,3.91,3.91,0,0,0,4,4,3.91,3.91,0,0,0,4-4A3.91,3.91,0,0,0,16,12Z"></path><title>Settings</title></svg>
                </button>
            </div>
        </div>
        <div id="settings-details" style="display: none;">
            <!-- Carbon tabs container -->
            <div class="bx--tabs" role="navigation">
                <!-- Tab list -->
                <div class="bx--tabs-trigger">
                    <a href="javascript:void(0)" class="bx--tabs-trigger-text" tabindex="0">Play Settings</a>
                    <svg focusable="false" preserveAspectRatio="xMidYMid meet" style="will-change: transform;" xmlns="http://www.w3.org/2000/svg" width="10" height="6" viewBox="0 0 10 6" aria-hidden="true"><path d="M5 6L0 1 0.7 0.3 5 4.6 9.3 0.3 10 1z"></path></svg>
                </div>
                <ul class="bx--tabs__nav bx--tabs__nav--hidden" role="tablist">
                    <li class="bx--tabs__nav-item bx--tabs__nav-item--selected" role="tab" aria-selected="true">
                        <a class="bx--tabs__nav-link" href="javascript:void(0)" role="tab">Play Settings</a>
                    </li>
                    <li class="bx--tabs__nav-item" role="tab">
                        <a class="bx--tabs__nav-link" href="javascript:void(0)" role="tab">Tag Select</a>
                    </li>
                    <li class="bx--tabs__nav-item" role="tab">
                        <a class="bx--tabs__nav-link" href="javascript:void(0)" role="tab">Playlist</a>
                    </li>
                    <li class="bx--tabs__nav-item" role="tab">
                        <a class="bx--tabs__nav-link" href="javascript:void(0)" role="tab">Upload</a>
                    </li>
                </ul>
            </div>

            <!-- Tab panels -->
            <div class="bx--tab-content">
                <!-- Play Settings tab panel -->
                <div id="tab-panel-1" class="bx--tab-panel" role="tabpanel" aria-labelledby="tab-link-1" aria-hidden="false">
                    <div class="settings-group">
                        <div class="settings-row">

                            <!-- Time inputs using Carbon Number Input -->
                            <div class="bx--form-item bx--number">
                                <div class="time-inputs">
                                    <div class="bx--form-item">
                                        <label for="minutes" class="bx--label">Minutes</label>
                                        <input type="number" id="minutes" min="0" max="60" value="0" class="bx--text-input bx--number__input" />
                                    </div>
                                    <div class="bx--form-item">
                                        <label for="seconds" class="bx--label">Seconds</label>
                                        <input type="number" id="seconds" min="0" max="59" value="3" class="bx--text-input bx--number__input" />
                                    </div>
                                </div>
                            </div>

                            <!-- Order buttons using Carbon Button Set -->
                            <div class="bx--form-item" id="orderContainer">
                                <label class="bx--label">Order:</label>
                                <div class="bx--btn-set">
                                    <button id="orderRandom" class="bx--btn bx--btn--secondary">Random</button>
                                    <button id="orderAlphabetical" class="bx--btn bx--btn--secondary">Alphabetical</button>
                                    <button id="orderGroups" class="bx--btn bx--btn--secondary">Tags</button>
                                </div>
                            </div>

                            <!-- Save button using Carbon Button with icon -->
                            <button id="saveSettingsBtn" class="bx--btn bx--btn--primary">
                                <svg focusable="false" preserveAspectRatio="xMidYMid meet" fill="currentColor" 
                                    width="16" height="16" viewBox="0 0 16 16" aria-hidden="true">
                                    <path d="M13.9,4.6l-2.5-2.5C11.3,2.1,11.1,2,11,2H3C2.4,2,2,2.4,2,3v10c0,0.6,0.4,1,1,1h10c0.6,0,1-0.4,1-1V5      C14,4.9,13.9,4.7,13.9,4.6z M6,3h4v2H6V3z M10,13H6V9h4V13z M11,13V9c0-0.6-0.4-1-1-1H6C5.4,8,5,8.4,5,9v4H3V3h2v2c0,0.6,0.4,1,1,1     h4c0.6,0,1-0.4,1-1V3.2l2,2V13H11z"/>
                                </svg>
                                <span>Save</span>
                            </button>
                            <div id="saveMessage" class="bx--toast-notification bx--toast-notification--success" role="alert" style="display: none;">
                                <div class="bx--toast-notification__details">
                                    <h3 class="bx--toast-notification__title">Success</h3>
                                    <p class="bx--toast-notification__subtitle">Settings saved successfully.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tag Select tab panel -->
                <div id="tab-panel-2" class="bx--tab-panel" role="tabpanel" aria-labelledby="tab-link-2" aria-hidden="true">
                    <div id="tagSelectionWrapper">

                        <button id="playTagsBtn" class="play-button">Play tags</button>
                        <div id="tagSelectionContainer" style="display:flex; flex-wrap: wrap; gap: 0.3em;"></div>
                    </div>
                </div>

                <!-- Playlist tab panel -->
                <div id="tab-panel-3" class="bx--tab-panel" role="tabpanel" aria-labelledby="tab-link-3" aria-hidden="true">
                    <div id="playlistSection">
                        <!-- Playlist content will go here -->
                        <h3>Playlists</h3>
                        <p>Coming soon...</p>
                    </div>
                </div>

                <!-- Upload tab panel -->
                <div id="tab-panel-4" class="bx--tab-panel" role="tabpanel" aria-labelledby="tab-link-4" aria-hidden="true">
                    <section id="uploadSection">

                        <div id="dropArea">
                            <p>Drag & Drop Files Here</p>
                            <button id="selectFiles">Select Files</button>
                        </div>
                        <input type="file" id="fileInput" multiple style="display:none;" />
                        <div id="uploadStatus"></div>
                    </section>
                </div>
            </div>
        </div>
    </section>

    <!-- Pictures Management Section -->
    <section id="management">
        <!-- Wrap the search bar and new filter button in a container -->
        <div id="filterContainer" style="display:flex; align-items:center; gap:0.5rem;">
            <button id="tagManagerToggle" title="Manage Tags">
                <svg focusable="false" preserveAspectRatio="xMidYMid meet" fill="currentColor" width="24" height="24" viewBox="0 0 32 32">
                    <circle cx="14" cy="14" r="2"></circle>
                    <path d="M20,30a.9967.9967,0,0,1-.707-.293L8.5859,19A2.0126,2.0126,0,0,1,8,17.5859V10a2.002,2.002,0,0,1,2-2h7.5859A1.9864,1.9864,0,0,1,19,8.5859L29.707,19.293a.9994.9994,0,0,1,0,1.414l-9,9A.9967.9967,0,0,1,20,30ZM10,10v7.5859l10,10L27.5859,20l-10-10Z"></path>
                    <path d="M12,30H4a2.0021,2.0021,0,0,1-2-2V4A2.0021,2.0021,0,0,1,4,2H28a2.0021,2.0021,0,0,1,2,2v8H28V4H4V28h8Z"></path>
                </svg>
            </button>

            <button id="playlistManagerToggle" class="settingsToggle" title="Playlist Manager">
                <svg focusable="false" preserveAspectRatio="xMidYMid meet" fill="currentColor" width="24" height="24" viewBox="0 0 32 32" aria-hidden="true">
                    <path d="M4 6H28V8H4zM4 13H28V15H4zM4 20H28V22H4zM4 27H28V29H4z"></path>
                </svg>
            </button>
            <input type="text" id="search" placeholder="Search pictures..." />
            <!-- Filter button -->
            <button id="filterBtn" title="Filter images">
                <svg width="24" height="24" viewBox="0 0 32 32" fill="currentColor" aria-hidden="true">
                    <path d="M4 6h24v2H4zm4 8h16v2H8zm6 8h4v2h-4z"></path>
                </svg>
            </button>
            <!-- NEW: Bulk delete button as icon -->
            <button id="bulkDelete" title="Delete selected images">
                <svg focusable="false" preserveAspectRatio="xMidYMid meet" fill="currentColor" width="24" height="24" viewBox="0 0 32 32">
                    <path d="M12 12H14V24H12zM18 12H20V24H18z"></path>
                    <path d="M4 6V8H6V28a2 2 0 002 2H24a2 2,0,002-2V8h2V6zM8 28V8H24V28zM12 2H20V4H12z"></path>
                </svg>
            </button>
        </div>

        <div id="playlistManagerSection" style="display: none; margin-top: 1rem;">
            <div class="section-header">
                <h3>Playlists</h3>
                <button id="newPlaylistBtn" class="bx--btn bx--btn--primary">New Playlist</button>
            </div>
            <div id="playlistContainer">
                <!-- Playlists will be dynamically added here -->
            </div>
        </div>

        <!-- NEW: Move tag management forms outside filterContainer but keep them in management section -->
        <form id="newTagForm" style="display: none;">
            <input type="text" id="newTagName" placeholder="New tag name" required />
            <button type="submit">Add</button>
        </form>
        <div id="tagManagerSection" style="display: none;"></div>

        <!-- Replace the existing filterTabsWrapper div -->
        <div id="filterTabsWrapper">
            <div class="filter-grid">
                <div class="tags-section">
                    <h3>Filter by Tags</h3>
                    <div id="tagFilterDropdown"></div>
                </div>
                <div class="playlist-section">
                    <h3>Playlists</h3>
                    <div id="playlistsContainer">
                        <p>Playlists feature coming soon!</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="slideFunctionsContainer">
            <button id="playSelectBtn">Play selected</button>
        </div>

        <table id="imageTable">
            <thead>
                <tr>
                    <th class="col-select" data-key="select">
                        <label class="custom-checkbox">
                            <input type="checkbox" id="headerSelect" />
                            <span class="checkmark"></span>
                        </label>
                    </th>
                    <th class="col-thumb"></th>
                    <th class="sortable col-name" data-key="title" data-label="Name">Name</th>
                    <th class="sortable col-tags" data-key="tags" data-label="Tags">Tags</th>
                    <th class="sortable col-date" data-key="dateAdded" data-label="Date">Date</th>
                    <th class="col-actions">Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <!-- Added pagination container -->
        <div id="pagination"></div>
        <div id="playlistManagerSection" style="display: none;">
            <div class="section-header">
                <h3>Playlists</h3>
                <button id="newPlaylistBtn">New Playlist</button>
            </div>
            <div id="playlistContainer">
                <!-- Playlists will be dynamically added here -->
            </div>
        </div>
    </section>

    <!-- Add Socket.IO before other scripts -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="socket-client.js"></script>
    <script src="main.js"></script>
    <script src="sw-register.js"></script>
    <!-- NEW: Fix #settingsToggle panel toggle -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const settingsToggle = document.getElementById('settingsToggle');
            const settingsDetails = document.getElementById('settings-details');

            // Set initial state
            settingsDetails.style.display = 'none';

            // Toggle settings visibility
            settingsToggle.addEventListener('click', () => {
                settingsDetails.style.display =
                    settingsDetails.style.display === 'none' ? 'block' : 'none';

                // Toggle active state for the button
                settingsToggle.classList.toggle('active');
            });

            // Initialize Carbon tabs
            const tabList = document.querySelector('.bx--tabs__nav');
            const tabPanels = document.querySelectorAll('.bx--tab-panel');
            const tabItems = document.querySelectorAll('.bx--tabs__nav-item');

            function switchTab(index) {
                // Update tab selection
                tabItems.forEach((item, i) => {
                    if (i === index) {
                        item.classList.add('bx--tabs__nav-item--selected');
                        item.setAttribute('aria-selected', 'true');
                    } else {
                        item.classList.remove('bx--tabs__nav-item--selected');
                        item.setAttribute('aria-selected', 'false');
                    }
                });

                // Show/hide panels
                tabPanels.forEach((panel, i) => {
                    if (i === index) {
                        panel.setAttribute('aria-hidden', 'false');
                        panel.style.display = 'block';
                    } else {
                        panel.setAttribute('aria-hidden', 'true');
                        panel.style.display = 'none';
                    }
                });
            }

            // Add click handlers to tabs
            tabItems.forEach((item, index) => {
                item.addEventListener('click', () => switchTab(index));
            });

            // Initialize first tab
            switchTab(0);

            // Handle dropdown trigger for mobile
            const trigger = document.querySelector('.bx--tabs-trigger');
            trigger.addEventListener('click', () => {
                const nav = document.querySelector('.bx--tabs__nav');
                nav.classList.toggle('bx--tabs__nav--hidden');
            });
        });
    </script>
    <div id="editModal" class="modal" style="display:none;">
        <div class="modal-content">
            <h3>Edit Image Entry</h3>
            <form id="editForm">
                <label for="editTitle">Title:</label>
                <input type="text" id="editTitle" name="editTitle" required>
                <label for="editDescription">Description:</label>
                <textarea id="editDescription" name="editDescription"></textarea>
                <div class="modal-buttons">
                    <button type="button" id="saveEditBtn">Save</button>
                    <button type="button" id="closeEditBtn"></button>
                </div>
            </form>
        </div>
    </div>
    <!-- Add after the existing editModal -->
    <div id="tagEditModal" class="modal">
        <div class="modal-content">
            <button id="closeTagEditBtn" class="close-btn">&times;</button>
            <h3>Edit Tag</h3>
            <form id="tagEditForm">
                <div class="form-group">
                    <label for="editTagName">Tag Name:</label>
                    <input type="text" id="editTagName" required>
                </div>
                <div class="modal-buttons">
                    <button type="button" id="saveTagEditBtn">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</body>

</html>